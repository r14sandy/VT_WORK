
/** compiler directives **/
#include<reg51.h>
#include<string.h>

/**user defined header files **/
#include "sipo.h" 
#include "delay.h"

/** declare the rows connections **/
#define row P0 //anodes on board

/** fonts array **/
code unsigned char font[96][8]={ 
{0xff ,0xff ,0xff ,0xff ,0xff ,0xff ,0xff ,0xff},//space 0
{0xe7 ,0xc3 ,0xc3 ,0xe7 ,0xe7 ,0xff ,0xe7 ,0xff },//'!'  1
{0x99 ,0x99 ,0x99 ,0xff ,0xff ,0xff ,0xff ,0xff },//'"'  2 
{0xc9 ,0xc9 ,0x80 ,0xc9 ,0x80 ,0xc9 ,0xc9 ,0xff },//'#'  3
{0xf7 ,0xc1 ,0xf5 ,0xc1 ,0xd7 ,0xc1 ,0xf7 ,0xff },//'$'  4
{0xff ,0x9c ,0xcc ,0xe7 ,0xf3 ,0x99 ,0x9c ,0xff },//'%'  5
{0xe3 ,0xc9 ,0xe3 ,0x91 ,0xc4 ,0xcc ,0x91 ,0xff },//'&'  6
{0xe7 ,0xe7 ,0xf3 ,0xff ,0xff ,0xff ,0xff ,0xff },//'''  7
{0xcf ,0xe7 ,0xf3 ,0xf3 ,0xf3 ,0xe7 ,0xcf ,0xff },//'('  8
{0xf3 ,0xe7 ,0xcf ,0xcf ,0xcf ,0xe7 ,0xf3 ,0xff },//')'  9
{0xff ,0x99 ,0xc3 ,0x80 ,0xc3 ,0x99 ,0xff ,0xff },//'*'  10
{0xff ,0xe7 ,0xe7 ,0x81 ,0xe7 ,0xe7 ,0xff ,0xff },//'+'  11
{0xff ,0xff ,0xff ,0xff ,0xe7 ,0xe7 ,0xf3 ,0xff },//','  12
{0xff ,0xff ,0xff ,0x80 ,0xff ,0xff ,0xff ,0xff },//'-'  13
{0xff ,0xff ,0xff ,0xff ,0xff ,0xf3 ,0xf3 ,0xff },//'.'  14
{0x9f ,0xcf ,0xe7 ,0xf3 ,0xf9 ,0xfc ,0xfe ,0xff },//'/'  15
{0xc1 ,0x9c ,0x8c ,0x84 ,0x90 ,0x98 ,0xc1 ,0xff },//'0'  16
{0xe7 ,0xe3 ,0xe7 ,0xe7 ,0xe7 ,0xe7 ,0x81 ,0xff },//'1'  17
{0xc3 ,0x99 ,0x9f ,0xc7 ,0xf3 ,0x99 ,0x81 ,0xff },//'2'  18
{0xc3 ,0x99 ,0x9f ,0xc7 ,0x9f ,0x99 ,0xc3 ,0xff },//'3'  19
{0xc7 ,0xc3 ,0xc9 ,0xcc ,0x80 ,0xcf ,0x87 ,0xff },//'4'  20
{0x81 ,0xf9 ,0xc1 ,0x9f ,0x9f ,0x99 ,0xc3 ,0xff },//'5'  21
{0xc7 ,0xf3 ,0xf9 ,0xc1 ,0x99 ,0x99 ,0xc3 ,0xff },//'6'  22
{0x81 ,0x99 ,0x9f ,0xcf ,0xe7 ,0xe7 ,0xe7 ,0xff },//'7'  23
{0xc3 ,0x99 ,0x99 ,0xc3 ,0x99 ,0x99 ,0xc3 ,0xff },//'8'  24
{0xc3 ,0x99 ,0x99 ,0x83 ,0x9f ,0xcf ,0xe3 ,0xff },//'9'  25
{0xff ,0xf3 ,0xf3 ,0xff ,0xff ,0xf3 ,0xf3 ,0xff },//':'  26
{0xf3 ,0xf3 ,0xff ,0xff ,0xf3 ,0xf3 ,0xf9 ,0xff },//';'  27
{0xe7 ,0xf3 ,0xf9 ,0xfc ,0xf9 ,0xf3 ,0xe7 ,0xff },//'<'  28
{0xff ,0xff ,0x80 ,0xff ,0xff ,0x80 ,0xff ,0xff },//'='  29
{0xf9 ,0xf3 ,0xe7 ,0xcf ,0xe7 ,0xf3 ,0xf9 ,0xff },//'>'  30
{0xe1 ,0xcc ,0xcf ,0xe7 ,0xf3 ,0xff ,0xf3 ,0xff },//'?'  31
{0xc1 ,0x9c ,0x84 ,0x84 ,0x84 ,0xfc ,0xe1 ,0xff },//'@'  32
{0xe7 ,0xc3 ,0x99 ,0x99 ,0x81 ,0x99 ,0x99 ,0xff },//'A'  33
{0xc0 ,0x99 ,0x99 ,0xc1 ,0x99 ,0x99 ,0xc0 ,0xff },//'B'
{0xc3 ,0x99 ,0xfc ,0xfc ,0xfc ,0x99 ,0xc3 ,0xff },//'C'
{0xe0 ,0xc9 ,0x99 ,0x99 ,0x99 ,0xc9 ,0xe0 ,0xff },//'D'
{0x80 ,0xb9 ,0xe9 ,0xe1 ,0xe9 ,0xb9 ,0x80 ,0xff },//'E'
{0x80 ,0xb9 ,0xe9 ,0xe1 ,0xe9 ,0xf9 ,0xf0 ,0xff },//'F'
{0xc3 ,0x99 ,0xfc ,0xfc ,0x8c ,0x99 ,0x81 ,0xff },//'G'
{0x99 ,0x99 ,0x99 ,0x81 ,0x99 ,0x99 ,0x99 ,0xff },//'H'
{0xc3 ,0xe7 ,0xe7 ,0xe7 ,0xe7 ,0xe7 ,0xc3 ,0xff },//'I'
{0x87 ,0xcf ,0xcf ,0xcf ,0xcc ,0xcc ,0xe1 ,0xff },//'J'
{0x98 ,0x99 ,0xc9 ,0xe1 ,0xc9 ,0x99 ,0x98 ,0xff },//'K'
{0xf0 ,0xf9 ,0xf9 ,0xf9 ,0xb9 ,0x99 ,0x80 ,0xff },//'L'
{0x9c ,0x88 ,0x80 ,0x80 ,0x94 ,0x9c ,0x9c ,0xff },//'M'
{0x9c ,0x98 ,0x90 ,0x84 ,0x8c ,0x9c ,0x9c ,0xff },//'N'
{0xe3 ,0xc9 ,0x9c ,0x9c ,0x9c ,0xc9 ,0xe3 ,0xff },//'O'
{0xc0 ,0x99 ,0x99 ,0xc1 ,0xf9 ,0xf9 ,0xf0 ,0xff },//'P'
{0xc3 ,0x99 ,0x99 ,0x99 ,0x89 ,0xc3 ,0x8f ,0xff },//'Q'
{0xc0 ,0x99 ,0x99 ,0xc1 ,0x89 ,0x99 ,0x98 ,0xff },//'R'
{0xc3 ,0x99 ,0xf1 ,0xe3 ,0x8f ,0x99 ,0xc3 ,0xff },//'S'
{0x81 ,0xa5 ,0xe7 ,0xe7 ,0xe7 ,0xe7 ,0xc3 ,0xff },//'T'
{0x99 ,0x99 ,0x99 ,0x99 ,0x99 ,0x99 ,0xc3 ,0xff },//'U'
{0x99 ,0x99 ,0x99 ,0x99 ,0x99 ,0xc3 ,0xe7 ,0xff },//'V'
{0x9c ,0x9c ,0x9c ,0x94 ,0x80 ,0x88 ,0x9c ,0xff },//'W'
{0x9c ,0xc9 ,0xe3 ,0xf7 ,0xe3 ,0xc9 ,0x9c ,0xff },//'X'
{0x99 ,0x99 ,0x99 ,0xc3 ,0xe7 ,0xe7 ,0xc3 ,0xff },//'Y'
{0x80 ,0x9c ,0xce ,0xe7 ,0xb3 ,0x99 ,0x80 ,0xff },//'Z'
{0xe1 ,0xf9 ,0xf9 ,0xf9 ,0xf9 ,0xf9 ,0xe1 ,0xff },//'['
{0xfc ,0xf9 ,0xf3 ,0xe7 ,0xcf ,0x9f ,0xbf ,0xff },//'\'
{0xe1 ,0xe7 ,0xe7 ,0xe7 ,0xe7 ,0xe7 ,0xe1 ,0xff },//']'
{0xf7 ,0xe3 ,0xc9 ,0x9c ,0xff ,0xff ,0xff ,0xff },//'^'
{0xff ,0xff ,0xff ,0xff ,0xff ,0xff ,0xff ,0x80 },//'_'
{0xf3 ,0xf3 ,0xe7 ,0xff ,0xff ,0xff ,0xff ,0xff },//'`'
{0xff ,0xff ,0xe1 ,0xcf ,0xc1 ,0xcc ,0x91 ,0xff },//'a'
{0xf8 ,0xf9 ,0xf9 ,0xc1 ,0x99 ,0x99 ,0xc4 ,0xff },//'b'
{0xff ,0xff ,0xe1 ,0xcc ,0xfc ,0xcc ,0xe1 ,0xff },//'c'
{0xc7 ,0xcf ,0xcf ,0xc1 ,0xcc ,0xcc ,0x91 ,0xff },//'d'
{0xff ,0xff ,0xe1 ,0xcc ,0xc0 ,0xfc ,0xe1 ,0xff },//'e'
{0xe3 ,0xc9 ,0xf9 ,0xf0 ,0xf9 ,0xf9 ,0xf0 ,0xff },//'f'
{0xff ,0xff ,0xe1 ,0xcc ,0xcc ,0xc0 ,0xcf ,0xe1 },//'g'
{0xf8 ,0xf9 ,0xc9 ,0x91 ,0x99 ,0x99 ,0x98 ,0xff },//'h'
{0xf3 ,0xff ,0xf1 ,0xf3 ,0xf3 ,0xf3 ,0xe1 ,0xff },//'i'
{0xcf ,0xff ,0xcf ,0xcf ,0xcf ,0xcc ,0xcc ,0xe1 },//'j'
{0xf8 ,0xf9 ,0x99 ,0xc9 ,0xe1 ,0xc9 ,0x98 ,0xff },//'k'
{0xf1 ,0xf3 ,0xf3 ,0xf3 ,0xf3 ,0xf3 ,0xe1 ,0xff },//'l'
{0xff ,0xff ,0xc9 ,0x80 ,0x80 ,0x94 ,0x9c ,0xff },//'m'
{0xff ,0xff ,0xe0 ,0xcc ,0xcc ,0xcc ,0xcc ,0xff },//'n'
{0xff ,0xff ,0xe1 ,0xcc ,0xcc ,0xcc ,0xe1 ,0xff },//'o'
{0xff ,0xff ,0xc1 ,0x99 ,0x99 ,0xc1 ,0xf9 ,0xf1 },//'p'
{0xff ,0xff ,0x91 ,0xcc ,0xcc ,0xc1 ,0xcf ,0x87 },//'q'
{0xff ,0xff ,0xc4 ,0x91 ,0x99 ,0xf9 ,0xf0 ,0xff },//'r'
{0xff ,0xff ,0xc1 ,0xfc ,0xe1 ,0xcf ,0xe0 ,0xff },//'s'
{0xf7 ,0xf3 ,0xc1 ,0xf3 ,0xf3 ,0xd3 ,0xe7 ,0xff },//'t'
{0xff ,0xff ,0xcc ,0xcc ,0xcc ,0xcc ,0x91 ,0xff },//'u'
{0xff ,0xff ,0xcc ,0xcc ,0xcc ,0xe1 ,0xf3 ,0xff },//'v'
{0xff ,0xff ,0x9c ,0x94 ,0x80 ,0x80 ,0xc9 ,0xff },//'w'
{0xff ,0xff ,0x9c ,0xc9 ,0xe3 ,0xc9 ,0x9c ,0xff },//'x'
{0xff ,0xff ,0xcc ,0xcc ,0xcc ,0xc0 ,0xcf ,0xe7 },//'y'
{0xff ,0xff ,0xc0 ,0xe6 ,0xf3 ,0xd9 ,0xc0 ,0xff },//'z'
{0xc7 ,0xf3 ,0xf3 ,0xf8 ,0xf3 ,0xf3 ,0xc7 ,0xff },//'{'
{0xe7 ,0xe7 ,0xe7 ,0xff ,0xe7 ,0xe7 ,0xe7 ,0xff },//'|'
{0xf8 ,0xf3 ,0xf3 ,0xc7 ,0xf3 ,0xf3 ,0xf8 ,0xff },//'}'
{0x91 ,0xc4 ,0xff ,0xff ,0xff ,0xff ,0xff ,0xff },//'~'
};


/** display single character on dot matrix **/
/*void display_char(unsigned char ch,unsigned char delay)
{
	unsigned int j=0,x;	//local variables
//based on delay value same character is displyed on dot matrix
//delay is used for user visibility
	for(x=0;x<delay;x++)	
	{
		
		for(j=0;j<8;j++)	//used for selecting the row by row
		{
			row=0x00;	//
			_74hc164_tx(font[ch-32][j]);	//display 1st character
			row=1<<j;	//selecting j row position
			delay_us(40);
		}
		row=0;	//row value 0 for sending data next time
		
	}
	
}*/						

/*void display_char(unsigned char *str,unsigned char delay)
{
	
	unsigned int j=0,x,ch,k=0;
	for(x=0;x<delay;x++)	
	{
		while(*str)
		{
			ch=(*str);
			str++;	
			for(j=0;j<8;j++)	//used for selecting the row by row
			{
				row=0x00;	//
				_74hc164_tx(font[ch-32][j],k);
				//_74hc164_tx(font[ch-32][j],k);//display 1st character
				
				row=1<<j;	//selecting j row position
				delay_us(40);
			}
			k++;
			row=0;	//row value 0 for sending data next time
		}	
	}
}*/



void display_const_string(unsigned char *str,unsigned char delay)
{
	
	unsigned int j=0,x,ch,k=0;
	
	for(x=0;x<delay;x++)	
	{
		
			ch=str[k];
				
			for(j=0;j<8;j++)	//used for selecting the row by row
			{
				row=0x00;	//
				_74hc164_tx1(font[ch-32][j]);
				//_74hc164_tx(font[ch-32][j],k);//display 1st character
				
				row=1<<j;	//selecting j row position
				delay_us(30);
			}
			row=0;	//row value 0 for sending data next time
		
			ch=str[k+1];
			for(j=0;j<8;j++)	//used for selecting the row by row
			{
				row=0x00;	//
	  			_74hc164_tx2(font[ch-32][j]);
				//_74hc164_tx(font[ch-32][j],k);//display 1st character
				
				row=1<<j;	//selecting j row position
				delay_us(30);
			}
			row=0;
	
			ch=str[k+2];
			for(j=0;j<8;j++)	//used for selecting the row by row
			{
				row=0x00;	//
				_74hc164_tx3(font[ch-32][j]);
				//_74hc164_tx(font[ch-32][j],k);//display 1st character
				
				row=1<<j;	//selecting j row position
				delay_us(30);
			}
			row=0;
	
	
			ch=str[k+3];
			for(j=0;j<8;j++)	//used for selecting the row by row
			{
				row=0x00;	//
				_74hc164_tx4(font[ch-32][j]);
				//_74hc164_tx(font[ch-32][j],k);//display 1st character
				
				row=1<<j;	//selecting j row position
				delay_us(30);
			}
			row=0;
	}
//	}
}


//////////string scrolling////////////////

void scroll_string(unsigned char *s,unsigned char delay)
{
	unsigned int k,j,x;
	for(k=0;s[k];k++)
	{
		for(x=0;x<delay;x++)	
		{
			for(j=0;j<8;j++)
			{
				row=0x00;	
				_74hc164_tx1(font[s[k]-32][j]);
								
				row=1<<j;	
				delay_us(30);
			}
			row=0;	//row value 0 for sending data next time
		
			
			for(j=0;j<8;j++)	
			{
				row=0x00;	//
				_74hc164_tx2(font[s[k+1]-32][j]);
				
				
				row=1<<j;	
				delay_us(30);
			}
			row=0;
	
			
			for(j=0;j<8;j++)	//used for selecting the row by row
			{
				row=0x00;	//
				_74hc164_tx3(font[s[k+2]-32][j]);
				//_74hc164_tx(font[ch-32][j],k);//display 1st character
				
				row=1<<j;	//selecting j row position
				delay_us(30);
			}
			row=0;
	
	
			
			for(j=0;j<8;j++)	//used for selecting the row by row
			{
				row=0x00;	//
				_74hc164_tx4(font[s[k+3]-32][j]);
				//_74hc164_tx(font[ch-32][j],k);//display 1st character
				
				row=1<<j;	//selecting j row position
				delay_us(30);
			}
			row=0;
		}
	}	


}




